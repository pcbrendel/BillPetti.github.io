---
layout: post
title: Making the Model Part 3 - Feature Engineering
tags: Python
---

This is the third post in a series called Making the Model, which documents my journey to building a data set and creating the best model to predict baseball daily fantasy sports (DFS) scores. With the projected performances from such a model, a user can set an optimal lineup in FanDuel or DraftKings and dominate the competition. However, before reaching this goal, there will be many obstacles along the way. This post describes a couple of interesting feature engineering techniques I performed.

Feature engineering is one aspect of the machine learning workflow that really requires a human eye. It is the process of transforming the features in the data into features that are more meaningful and will lead to better predictions.

The two approaches 

### Aggregating batting features across all nine batters

This technique is applicable to the model predicting pitching performance. In trying to predict how well a pitcher will do in a game, it's necessary to know the skill of the opposing batters. On one hand, there are nine opposing batters, and if you include features for each of the batters individually, then the features related to the opposing hitters will overwhelm the features related to the pitcher. On the other hand, if you just take into account overall batting stats for the opposing team as a whole, this won't provide an optimal amount of detail. Imagine the scenario where a pitcher is playing against the best hitting team in baseball, but the team's two best hitters are out with the flu. There may be a big gap in the team's "usual" ability and the team's ability for this particular game.

I figured that the best solution would be to average each hitting feature across all nine batters. However, it became apparent to me that the player batting ninth should not receive the same amount of weight as the player batting first; players batting closer to the front of the batting order are expected to have more at bats than a player batting towards the end of the order. 

https://fantasy.fangraphs.com/buying-generic-plate-appearances-by-lineup-spot/

```python
weights = [4.65, 4.55, 4.43, 4.33, 4.24, 4.13, 4.01, 3.90, 3.77]
batters = ["batter" + str(i) for i in range(1,10)]
stats = [i[8:] for i in list(df_pitching2.columns) if "batter1" in i]

for stat in stats:
    features = [i + "_" + stat for i in batters]
    masked_data = np.ma.masked_array(df_pitching2[features], np.isnan(df_pitching2[features]))
    new_stat = "batter_" + stat
    df_pitching2[new_stat] = np.ma.average(masked_data, axis=1, weights=weights)
    df_pitching2 = df_pitching2.drop(features, 1)
```

### Combining the 'previous season' statistic with the 'season-to-date

```python
```
